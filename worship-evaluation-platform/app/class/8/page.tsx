"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Progress } from "@/components/ui/progress"
import { BookOpen, CheckCircle, ArrowLeft, ArrowRight, Heart, Music } from "lucide-react"

const mockClass = {
  id: 8,
  title: "El fluir profético en la adoración",
  pillar: "Formación Técnica y Musical",
  premise: "Dejar espacio para que Dios hable, cómo identificar el fluir del Espíritu sin caer en desorden.",
  objective:
    "Introducir a los adoradores en el fluir profético, enseñándoles a cantar lo que el Espíritu está diciendo.",
  reflection:
    "Los miembros deben estar abiertos a cantar espontáneamente y ser sensibles a lo que el Espíritu está revelando en el momento.",
  focus: "Dejar espacio para que Dios hable, cómo identificar el fluir del Espíritu sin caer en desorden.",
  bibleBase: "Romanos 8:14, 1 Corintios 14:26-33",
  content: `
# El Fluir Profético en la Adoración

## Introducción
La adoración profética es una dimensión especial del ministerio donde permitimos que el Espíritu Santo hable a través de nosotros. No es solo cantar canciones, sino ser instrumentos para que Dios comunique Su corazón a Su pueblo.

## Fundamento Bíblico

### Romanos 8:14
*"Porque todos los que son guiados por el Espíritu de Dios, éstos son hijos de Dios."*

La adoración profética requiere ser guiados por el Espíritu Santo, no por nuestras emociones o preferencias musicales.

### 1 Corintios 14:26-33
*"¿Qué hay, pues, hermanos? Cuando os reunís, cada uno de vosotros tiene salmo, tiene doctrina, tiene lengua, tiene revelación, tiene interpretación. Hágase todo para edificación."*

Pablo establece principios de orden y edificación que también aplican a la adoración profética.

## ¿Qué es el Fluir Profético?

### Definición
El fluir profético en la adoración es cuando el Espíritu Santo inspira canciones, melodías o palabras espontáneas que comunican el corazón de Dios en el momento presente.

### Características del Fluir Profético:
- **Espontaneidad guiada**: No es planificado, pero tampoco es caótico
- **Edificación**: Siempre edifica, consuela y exhorta (1 Cor 14:3)
- **Sensibilidad espiritual**: Requiere estar sintonizados con el Espíritu
- **Orden bíblico**: Se mantiene dentro de los principios escriturales

## Cómo Identificar el Fluir del Espíritu

### Señales del Movimiento del Espíritu:
1. **Unidad en el equipo**: Todos sienten la misma dirección
2. **Paz sobrenatural**: No hay prisa ni ansiedad
3. **Edificación evidente**: La congregación es ministrada
4. **Confirmación escritural**: Alineado con la Palabra de Dios

### Diferencias entre Emoción y Espíritu:
- **Emoción**: Viene de nosotros, puede ser manipulada
- **Espíritu**: Viene de Dios, trae transformación genuina
- **Emoción**: Se enfoca en sentimientos
- **Espíritu**: Se enfoca en la gloria de Dios

## Principios para el Fluir Profético

### 1. Preparación Espiritual
- Vida de oración constante
- Conocimiento de la Palabra
- Sensibilidad al Espíritu Santo
- Corazón puro y humilde

### 2. Discernimiento
- Distinguir entre impulso humano y dirección divina
- Evaluar si edifica o confunde
- Confirmar con líderes espirituales
- Mantener orden bíblico

### 3. Ejecución Ordenada
- Respetar la autoridad establecida
- No interrumpir abruptamente
- Fluir con el equipo, no en solitario
- Mantener la edificación como meta

## Errores Comunes a Evitar

### 1. Confundir Emoción con Profecía
No todo sentimiento fuerte es del Espíritu Santo. Debemos discernir entre nuestras emociones y la voz de Dios.

### 2. Falta de Orden
El Espíritu Santo no es autor de confusión. Todo debe hacerse decentemente y con orden (1 Cor 14:40).

### 3. Protagonismo Personal
El fluir profético no es para lucirse, sino para que Dios sea glorificado y Su pueblo edificado.

### 4. Falta de Sujeción
Siempre debe haber sujeción a la autoridad espiritual establecida en la iglesia.

## Desarrollando Sensibilidad Profética

### Prácticas Recomendadas:
1. **Tiempo de intimidad con Dios**: Desarrollar el oído espiritual
2. **Estudio de la Palabra**: Conocer el carácter de Dios
3. **Oración intercesora**: Sintonizar con el corazón de Dios
4. **Mentoreo espiritual**: Aprender de líderes maduros

### En el Momento del Servicio:
- Mantener los ojos en Jesús, no en la congregación
- Estar atento a la dirección del líder de alabanza
- Orar en el espíritu mientras se ministra
- Estar dispuesto a cambiar de dirección si es necesario

## Casos Bíblicos de Adoración Profética

### David y Saúl (1 Samuel 16:23)
David tocaba y el espíritu malo se apartaba de Saúl. La música ungida tiene poder espiritual.

### Los Levitas en el Templo (1 Crónicas 25:1-3)
Fueron apartados para "profetizar con arpas, salterios y címbalos". La música era un vehículo profético.

### María (Lucas 1:46-55)
Su cántico profético (Magnificat) fue inspirado por el Espíritu Santo.

## Aplicación Práctica

### Para el Adorador Individual:
- Desarrolla tu vida devocional
- Practica la sensibilidad al Espíritu
- Estudia ejemplos bíblicos
- Busca mentoreo espiritual

### Para el Equipo de Alabanza:
- Oren juntos antes del servicio
- Establezcan señales para comunicarse
- Respeten la autoridad del líder
- Evalúen juntos después del servicio

## Reflexión Personal

**Pregunta para meditar**: ¿Estoy más interesado en que la gente me escuche a mí, o en que escuchen a Dios a través de mí?

**Compromiso**: Me comprometo a desarrollar mi sensibilidad espiritual y a estar disponible para que Dios me use como Su instrumento en la adoración.

## Conclusión

El fluir profético en la adoración es un privilegio y una responsabilidad. Requiere madurez espiritual, sensibilidad al Espíritu Santo y sujeción a la autoridad. Cuando se practica correctamente, trae edificación, consolación y exhortación al pueblo de Dios.

Recordemos que no somos los protagonistas, sino instrumentos en las manos del Maestro. Que nuestro deseo sea siempre que Él sea glorificado y Su pueblo bendecido.
  `,
  evaluation: {
    questions: [
      {
        id: 1,
        type: "multiple-choice",
        question: "Según la lección, ¿cuál es la diferencia principal entre emoción y fluir del Espíritu?",
        options: [
          "La emoción es más intensa que el fluir del Espíritu",
          "La emoción viene de nosotros y puede ser manipulada, el Espíritu viene de Dios y trae transformación",
          "No hay diferencia, ambos son válidos",
          "El fluir del Espíritu siempre es más ruidoso",
        ],
        correct: 1,
      },
      {
        id: 2,
        type: "multiple-choice",
        question: "¿Cuál de estos NO es una característica del fluir profético según la lección?",
        options: ["Espontaneidad guiada", "Edificación", "Desorden emocional", "Sensibilidad espiritual"],
        correct: 2,
      },
      {
        id: 3,
        type: "multiple-choice",
        question: "Según 1 Corintios 14:26-33, ¿cuál debe ser el propósito de todo en el servicio?",
        options: [
          "Impresionar a la congregación",
          "Mostrar talento musical",
          "Edificación",
          "Crear ambiente emocional",
        ],
        correct: 2,
      },
      {
        id: 4,
        type: "essay",
        question:
          "Describe una situación específica donde hayas experimentado o presenciado el fluir profético en la adoración. ¿Cómo identificaste que era del Espíritu Santo y no solo emoción humana?",
        minWords: 150,
      },
      {
        id: 5,
        type: "essay",
        question:
          "¿Cómo puedes desarrollar mayor sensibilidad al Espíritu Santo en tu vida personal para estar mejor preparado para el fluir profético? Menciona al menos 3 prácticas específicas.",
        minWords: 120,
      },
      {
        id: 6,
        type: "essay",
        question:
          "Reflexiona sobre esta pregunta de la lección: '¿Estoy más interesado en que la gente me escuche a mí, o en que escuchen a Dios a través de mí?' ¿Cómo esta reflexión cambia tu perspectiva sobre el ministerio de adoración?",
        minWords: 100,
      },
    ],
  },
}

export default function ClassPage() {
  const [currentSection, setCurrentSection] = useState<"content" | "evaluation">("content")
  const [answers, setAnswers] = useState<Record<number, string>>({})
  const [evaluationComplete, setEvaluationComplete] = useState(false)

  const handleAnswerChange = (questionId: number, answer: string) => {
    setAnswers((prev) => ({ ...prev, [questionId]: answer }))
  }

  const handleSubmitEvaluation = () => {
    setEvaluationComplete(true)
    alert("¡Evaluación enviada exitosamente! Tu puntuación estará disponible pronto.")
  }

  const progress =
    currentSection === "evaluation" ? (Object.keys(answers).length / mockClass.evaluation.questions.length) * 100 : 100

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-50 via-amber-50 to-orange-100">
      {/* Header */}
      <header className="bg-white border-b border-orange-200 shadow-sm">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center gap-4">
            <Button
              variant="outline"
              size="sm"
              onClick={() => window.history.back()}
              className="border-orange-200 text-orange-600 hover:bg-orange-50"
            >
              <ArrowLeft className="h-4 w-4 mr-2" />
              Volver al Panel
            </Button>
            <div className="flex items-center gap-3">
              <div className="p-2 bg-orange-600 rounded-lg">
                <Music className="h-6 w-6 text-white" />
              </div>
              <div>
                <h1 className="text-xl font-bold text-orange-900">
                  Sesión {mockClass.id}: {mockClass.title}
                </h1>
                <p className="text-orange-600">{mockClass.pillar}</p>
                <p className="text-sm text-orange-500 italic">{mockClass.bibleBase}</p>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div className="container mx-auto px-4 py-8">
        {/* Class Overview */}
        <Card className="border-orange-200 bg-white mb-6">
          <CardHeader>
            <CardTitle className="text-orange-900 flex items-center gap-2">
              <Heart className="h-5 w-5 text-orange-600" />
              Resumen de la Sesión
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div>
              <h4 className="font-semibold text-orange-800">Premisa:</h4>
              <p className="text-orange-700">{mockClass.premise}</p>
            </div>
            <div>
              <h4 className="font-semibold text-orange-800">Objetivo:</h4>
              <p className="text-orange-700">{mockClass.objective}</p>
            </div>
            <div>
              <h4 className="font-semibold text-orange-800">Enfoque:</h4>
              <p className="text-orange-700">{mockClass.focus}</p>
            </div>
            <div>
              <h4 className="font-semibold text-orange-800">Reflexión:</h4>
              <p className="text-orange-700">{mockClass.reflection}</p>
            </div>
          </CardContent>
        </Card>

        {/* Progress Bar */}
        <Card className="border-orange-200 bg-white mb-6">
          <CardContent className="pt-6">
            <div className="flex justify-between items-center mb-2">
              <span className="text-sm font-medium text-orange-900">
                {currentSection === "content" ? "Progreso de Lectura" : "Progreso de Evaluación"}
              </span>
              <span className="text-sm text-orange-600">{Math.round(progress)}%</span>
            </div>
            <Progress value={progress} className="h-2" />
          </CardContent>
        </Card>

        {/* Navigation Tabs */}
        <div className="flex gap-4 mb-6">
          <Button
            variant={currentSection === "content" ? "default" : "outline"}
            onClick={() => setCurrentSection("content")}
            className={
              currentSection === "content"
                ? "bg-orange-600 hover:bg-orange-700"
                : "border-orange-200 text-orange-600 hover:bg-orange-50"
            }
          >
            <BookOpen className="h-4 w-4 mr-2" />
            Contenido de la Sesión
          </Button>
          <Button
            variant={currentSection === "evaluation" ? "default" : "outline"}
            onClick={() => setCurrentSection("evaluation")}
            className={
              currentSection === "evaluation"
                ? "bg-orange-600 hover:bg-orange-700"
                : "border-orange-200 text-orange-600 hover:bg-orange-50"
            }
          >
            <CheckCircle className="h-4 w-4 mr-2" />
            Evaluación
          </Button>
        </div>

        {/* Content Section */}
        {currentSection === "content" && (
          <Card className="border-orange-200 bg-white">
            <CardHeader>
              <CardTitle className="text-orange-900">Material de la Sesión</CardTitle>
              <CardDescription className="text-orange-600">
                Lee cuidadosamente el material antes de proceder a la evaluación
              </CardDescription>
            </CardHeader>
            <CardContent className="prose prose-orange max-w-none">
              <div className="text-orange-900 leading-relaxed space-y-4">
                {mockClass.content.split("\n").map((line, index) => {
                  if (line.startsWith("# ")) {
                    return (
                      <h1 key={index} className="text-3xl font-bold text-orange-900 mt-8 mb-4">
                        {line.substring(2)}
                      </h1>
                    )
                  } else if (line.startsWith("## ")) {
                    return (
                      <h2 key={index} className="text-2xl font-semibold text-orange-800 mt-6 mb-3">
                        {line.substring(3)}
                      </h2>
                    )
                  } else if (line.startsWith("### ")) {
                    return (
                      <h3 key={index} className="text-xl font-medium text-orange-700 mt-4 mb-2">
                        {line.substring(4)}
                      </h3>
                    )
                  } else if (line.startsWith("- ")) {
                    return (
                      <li key={index} className="text-orange-700 ml-4">
                        {line.substring(2)}
                      </li>
                    )
                  } else if (line.startsWith("*") && line.endsWith("*")) {
                    return (
                      <p
                        key={index}
                        className="text-orange-600 italic font-medium bg-orange-50 p-3 rounded-lg border-l-4 border-orange-300"
                      >
                        {line.substring(1, line.length - 1)}
                      </p>
                    )
                  } else if (line.trim() === "") {
                    return <br key={index} />
                  } else {
                    return (
                      <p key={index} className="text-orange-700 mb-3">
                        {line}
                      </p>
                    )
                  }
                })}
              </div>
              <div className="mt-8 pt-6 border-t border-orange-200">
                <Button onClick={() => setCurrentSection("evaluation")} className="bg-orange-600 hover:bg-orange-700">
                  Proceder a la Evaluación
                  <ArrowRight className="h-4 w-4 ml-2" />
                </Button>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Evaluation Section */}
        {currentSection === "evaluation" && (
          <Card className="border-orange-200 bg-white">
            <CardHeader>
              <CardTitle className="text-orange-900">Evaluación de la Sesión</CardTitle>
              <CardDescription className="text-orange-600">
                Responde todas las preguntas para completar esta sesión. Tus respuestas serán calificadas
                automáticamente.
              </CardDescription>
            </CardHeader>
            <CardContent>
              {!evaluationComplete ? (
                <div className="space-y-6">
                  {mockClass.evaluation.questions.map((question, index) => (
                    <Card key={question.id} className="border-orange-100">
                      <CardHeader>
                        <CardTitle className="text-lg text-orange-900">
                          Pregunta {index + 1} de {mockClass.evaluation.questions.length}
                        </CardTitle>
                      </CardHeader>
                      <CardContent>
                        <p className="text-orange-800 mb-4 font-medium">{question.question}</p>

                        {question.type === "multiple-choice" && (
                          <RadioGroup
                            value={answers[question.id] || ""}
                            onValueChange={(value) => handleAnswerChange(question.id, value)}
                          >
                            {question.options?.map((option, optionIndex) => (
                              <div key={optionIndex} className="flex items-center space-x-2">
                                <RadioGroupItem value={optionIndex.toString()} id={`q${question.id}-${optionIndex}`} />
                                <Label htmlFor={`q${question.id}-${optionIndex}`} className="text-orange-700">
                                  {option}
                                </Label>
                              </div>
                            ))}
                          </RadioGroup>
                        )}

                        {question.type === "essay" && (
                          <div className="space-y-2">
                            <Textarea
                              placeholder="Escribe tu respuesta aquí..."
                              value={answers[question.id] || ""}
                              onChange={(e) => handleAnswerChange(question.id, e.target.value)}
                              className="min-h-32 border-orange-200 focus:border-orange-500"
                            />
                            <p className="text-sm text-orange-600">Mínimo {question.minWords} palabras requeridas</p>
                          </div>
                        )}
                      </CardContent>
                    </Card>
                  ))}

                  <div className="flex justify-between items-center pt-6">
                    <div className="text-sm text-orange-600">
                      {Object.keys(answers).length} de {mockClass.evaluation.questions.length} preguntas respondidas
                    </div>
                    <Button
                      onClick={handleSubmitEvaluation}
                      disabled={Object.keys(answers).length < mockClass.evaluation.questions.length}
                      className="bg-orange-600 hover:bg-orange-700 disabled:opacity-50"
                    >
                      Enviar Evaluación
                    </Button>
                  </div>
                </div>
              ) : (
                <div className="text-center py-12">
                  <CheckCircle className="h-16 w-16 text-green-600 mx-auto mb-4" />
                  <h3 className="text-2xl font-bold text-orange-900 mb-2">¡Evaluación Completada!</h3>
                  <p className="text-orange-700 mb-6">
                    Tus respuestas han sido enviadas exitosamente. Recibirás tu puntuación y retroalimentación pronto.
                  </p>
                  <Button
                    onClick={() => (window.location.href = "/student-dashboard")}
                    className="bg-orange-600 hover:bg-orange-700"
                  >
                    Volver al Panel
                  </Button>
                </div>
              )}
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  )
}
